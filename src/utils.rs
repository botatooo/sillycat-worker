use cfg_if::cfg_if;
use rand::Rng;
use resvg::render;
use tiny_skia::{Pixmap, Transform};
use usvg::{FitTo, Options, Tree};

// use worker::Fetch;

cfg_if! {
    // https://github.com/rustwasm/console_error_panic_hook#readme
    if #[cfg(feature = "console_error_panic_hook")] {
        extern crate console_error_panic_hook;
        pub use self::console_error_panic_hook::set_once as set_panic_hook;
    } else {
        #[inline]
        pub fn set_panic_hook() {}
    }
}

// pub async fn get_random_image_from_github() -> Vec<u8> {
//     // fetch a random image from https://github.com/User9684/silly-cat/tree/master/sillycats
//     let mut rng = rand::thread_rng();
//     let random_number = rng.gen_range(0, 100);
//     let url = format!(
//         "https://raw.githubusercontent.com/User9684/silly-cat/master/sillycats/{}.png",
//         random_number
//     );

//     let resp = Fetch::Url(Url::parse(&url).unwrap()).send().await;

//     resp.unwrap().bytes().await.unwrap()
// }

pub fn generate_random_hex_color() -> String {
    let mut rng = rand::thread_rng();
    let r = rng.gen_range(0..255);
    let g = rng.gen_range(0..255);
    let b = rng.gen_range(0..255);

    format!("{:02X}{:02X}{:02X}", r, g, b)
}

pub fn generate_image(color1: &str, color2: &str) -> Vec<u8> {
    let svg_data = format!(
        r##"
        <svg
          width="400px"
          height="400px"
          viewBox="0 0 66 66"
          xmlns="http://www.w3.org/2000/svg"
        >
        <g transform="translate(-72.000134,-116.53233)">
          <!-- rest of face -->
          <path
            fill="#{color1}"
            d="m 108.4591,165.54224 c -0.0499,-0.0499 -2.78054,-0.2661 -4.85376,-0.38422 -0.79163,-0.0451 -1.83938,-0.12204 -2.32833,-0.17099 -0.48895,-0.0489 -1.574802,-0.12736 -2.413002,-0.17424 -0.8382,-0.0469 -2.0955,-0.11771 -2.794,-0.15738 -0.6985,-0.0397 -2.527299,-0.0762 -4.063999,-0.0812 -2.923856,-0.009 -4.671219,-0.1009 -5.087425,-0.26621 -0.135616,-0.0539 -0.714825,-0.11763 -1.287129,-0.14169 -1.006069,-0.0423 -1.422226,-0.008 -3.531446,0.29143 -1.713749,0.24325 -3.297728,-0.005 -4.305166,-0.67342 -0.240409,-0.15962 -0.560314,-0.35393 -0.710899,-0.43181 -0.150585,-0.0779 -0.474224,-0.31294 -0.719196,-0.52237 -0.244973,-0.20944 -0.627207,-0.53639 -0.84941,-0.72655 -0.222202,-0.19016 -0.524059,-0.52286 -0.670793,-0.73933 -0.146734,-0.21647 -0.380006,-0.525 -0.518383,-0.68561 -0.138377,-0.16062 -0.324947,-0.46542 -0.4146,-0.67734 -0.08965,-0.21191 -0.276227,-0.61529 -0.414609,-0.8964 -0.393631,-0.79961 -0.498178,-1.69021 -0.496585,-4.23023 7.62e-4,-1.21074 0.03768,-2.44899 0.08205,-2.75167 0.04437,-0.30268 0.141014,-1.01451 0.214773,-1.58184 0.07376,-0.56733 0.224676,-1.31028 0.33537,-1.651 0.46395,-1.42804 0.643383,-1.88651 0.886816,-2.26586 0.141333,-0.22025 0.257605,-0.43522 0.258381,-0.47771 7.79e-4,-0.0425 0.174373,-0.363 0.38577,-0.71225 0.211397,-0.34925 0.521429,-0.92075 0.688961,-1.27 0.167531,-0.34925 0.370324,-0.73025 0.450651,-0.84667 0.08033,-0.11642 0.262795,-0.4868 0.405485,-0.82306 0.439669,-1.03614 1.506705,-2.40961 2.197161,-2.82814 0.173558,-0.10521 0.476268,-0.33058 0.672688,-0.50084 0.196419,-0.17025 0.653619,-0.43383 1.015999,-0.58574 0.362381,-0.15191 0.811273,-0.41522 0.99754,-0.58514 0.186267,-0.16992 0.548217,-0.43835 0.804333,-0.59652 0.256117,-0.15816 0.694267,-0.4305 0.973667,-0.60519 0.48756,-0.30485 2.388844,-1.15092 3.005667,-1.33752 0.162983,-0.0493 0.620183,-0.20852 1.016,-0.35381 0.395816,-0.14528 0.910166,-0.32167 1.142999,-0.39196 0.232834,-0.0703 0.651934,-0.19694 0.931334,-0.28143 0.2794,-0.0845 0.83185,-0.23578 1.227666,-0.3362 0.395817,-0.10041 0.948267,-0.25577 1.227667,-0.34524 0.2794,-0.0895 0.86995,-0.20757 1.312333,-0.26244 0.671063,-0.0832 0.853948,-0.13956 1.103777,-0.33993 0.325025,-0.26068 1.626586,-0.82945 1.903831,-0.83196 0.0942,-8.5e-4 0.539707,-0.095 0.990012,-0.20924 1.655753,-0.42001 2.378783,-0.47011 6.694451,-0.4638 2.19868,0.003 4.55004,0.0398 5.22526,0.0814 2.03143,0.12498 3.32042,0.23879 3.76766,0.33266 0.23284,0.0489 0.71874,0.14408 1.07978,0.21158 0.36926,0.069 1.05451,0.29927 1.56634,0.52626 l 0.90988,0.40354 1.905,0.002 c 1.93374,0.002 2.8168,-0.0943 3.683,-0.40278 0.18627,-0.0663 0.66252,-0.16655 1.05834,-0.22267 0.39581,-0.0561 0.96731,-0.17353 1.27,-0.26091 0.87389,-0.25227 1.75947,-0.33863 3.45629,-0.33705 2.4071,0.002 3.23466,0.24078 4.10806,1.18416 0.49359,0.53314 0.7513,1.0817 0.85502,1.82003 0.0327,0.23284 0.1754,0.82339 0.31709,1.31234 0.14633,0.50493 0.27666,1.18737 0.30169,1.57964 0.0552,0.86501 -0.0976,2.11013 -0.36437,2.96882 -0.11252,0.36219 -0.20515,0.7939 -0.20585,0.95934 -7.6e-4,0.17742 0.17792,0.71572 0.43559,1.31234 0.36262,0.83965 0.45802,1.16978 0.5614,1.94286 0.13484,1.00834 0.36862,1.61536 0.97015,2.51906 0.35831,0.53829 0.81702,1.54465 1.14801,2.5186 0.21035,0.61898 0.21665,0.70446 0.24953,3.38667 0.0337,2.75135 -0.0123,3.50263 -0.28017,4.572 -0.0642,0.25612 -0.17621,0.96097 -0.24901,1.56633 -0.22177,1.84418 -0.61006,2.80627 -1.51409,3.75164 -0.56269,0.58842 -0.74242,0.67532 -2.76201,1.33544 -0.86179,0.28168 -1.68219,0.34136 -2.32724,0.16929 -0.2788,-0.0744 -0.83125,-0.17224 -1.22767,-0.21747 -0.39642,-0.0452 -1.08271,-0.12794 -1.52509,-0.18379 -0.49095,-0.062 -2.99802,-0.12862 -6.43467,-0.17107 -3.09668,-0.0382 -5.82867,-0.0731 -6.07108,-0.0775 -0.5993,-0.0109 -1.25686,0.30213 -1.87671,0.89336 l -0.49185,0.46914 h -1.48107 c -0.81458,0 -1.50032,-0.0192 -1.52386,-0.0428 z"
          />
          <!-- border/outline -->
          <path
            fill="#464549"
            d="m 99.133453,168.02462 c 0.143201,-0.022 0.377525,-0.022 0.520726,0 0.1432,0.022 0.02606,0.0403 -0.260368,0.0403 -0.28639,0 -0.403558,-0.0181 -0.260358,-0.0403 z m 14.583657,-0.002 c 0.30132,-0.0193 0.76996,-0.0191 1.04144,3.9e-4 0.27148,0.0194 0.025,0.0351 -0.54784,0.0349 -0.57281,-2.1e-4 -0.79491,-0.016 -0.4936,-0.0353 z m 8.85472,-0.091 c 0.0683,-0.0278 0.15,-0.0246 0.18147,0.007 0.0314,0.032 -0.0245,0.0548 -0.12428,0.0507 -0.11024,-0.004 -0.13272,-0.0274 -0.0572,-0.0583 z m -34.468206,-0.0944 c 0.06508,-0.0268 0.171602,-0.0268 0.236695,0 0.06508,0.0268 0.01185,0.0487 -0.118342,0.0487 -0.130184,0 -0.183434,-0.0218 -0.118353,-0.0487 z m 40.237566,0 c 0.065,-0.0268 0.17159,-0.0268 0.23669,0 0.0651,0.0268 0.0118,0.0487 -0.11834,0.0487 -0.13019,0 -0.18344,-0.0218 -0.11835,-0.0487 z m -46.296863,-0.19304 c 0.06508,-0.0268 0.171604,-0.0268 0.236685,0 0.06509,0.0268 0.01186,0.0487 -0.118343,0.0487 -0.130183,0 -0.183434,-0.0218 -0.118342,-0.0487 z m 50.936013,0 c 0.065,-0.0268 0.17161,-0.0268 0.23669,0 0.0651,0.0268 0.0118,0.0487 -0.11833,0.0487 -0.13019,0 -0.18345,-0.0218 -0.11836,-0.0487 z m -25.27275,-8.10605 c 0.0683,-0.0279 0.15002,-0.0243 0.18147,0.007 0.0314,0.0319 -0.0245,0.0548 -0.12425,0.0507 -0.11026,-0.004 -0.13274,-0.0274 -0.0572,-0.0584 z m 4.65692,-1.41768 c 0,-0.02 0.0746,-0.0959 0.16568,-0.16883 0.15017,-0.12001 0.15352,-0.11658 0.0358,0.0365 -0.12368,0.16071 -0.20144,0.21182 -0.20144,0.13241 z m -25.775705,-6.20196 c 0.06508,-0.0268 0.171603,-0.0268 0.236684,0 0.06508,0.0268 0.01185,0.0487 -0.118342,0.0487 -0.130184,0 -0.183433,-0.0218 -0.118342,-0.0487 z m -7.929174,-8.65544 c 0,-0.02 0.07459,-0.096 0.165688,-0.16884 0.150166,-0.12 0.15351,-0.11659 0.03578,0.0365 -0.123676,0.16069 -0.201426,0.21181 -0.201426,0.1324 z m 2.841763,-3.06691 c 0.0089,-1.30418 0.227794,-3.26672 0.481879,-4.31214 0.250908,-1.03242 0.342882,-1.26088 0.684343,-1.69988 0.669461,-0.86069 1.533706,-1.29682 2.579685,-1.30182 0.49637,-0.002 3.604306,0.59874 3.898053,0.75393 0.09102,0.0481 0.367292,0.11723 0.61404,0.15371 0.463696,0.0684 1.797831,0.50729 2.296985,0.7554 0.156217,0.0776 0.571606,0.2622 0.923098,0.41011 0.351481,0.14791 0.639067,0.29551 0.639067,0.32801 0,0.0325 -0.287586,0.13988 -0.639067,0.23862 -0.551275,0.15486 -1.011437,0.34315 -2.632655,1.07728 -0.159169,0.0721 -0.627818,0.2796 -1.041439,0.46117 -0.413621,0.18156 -0.986367,0.43847 -1.272767,0.57091 -0.878536,0.40625 -2.134025,0.94067 -2.209909,0.94067 -0.207912,0 -2.341837,0.89139 -3.660038,1.52889 -0.2864,0.1385 -0.552672,0.26721 -0.591732,0.28604 -0.03903,0.0189 -0.07034,-0.067 -0.06956,-0.1909 z m 24.543456,-6.41789 c 0.0911,-0.0242 0.24024,-0.0242 0.33137,0 0.0911,0.0242 0.0165,0.0442 -0.1657,0.0442 -0.18225,0 -0.25681,-0.0198 -0.16567,-0.0442 z"
          />
          <!-- big left patch (cat pov) -->
          <path
            fill="#{color2}"
            d="m 125.88003,156.31051 c -3.08203,-0.23031 -3.6993,-0.3141 -5.32566,-0.7229 -1.9623,-0.49324 -4.3594,-1.67837 -5.88035,-2.90724 -1.28732,-1.04011 -4.27843,-4.5268 -4.97881,-5.80373 -0.14048,-0.25612 -0.4155,-0.7434 -0.61117,-1.08285 -0.19566,-0.33945 -0.39253,-0.71393 -0.43749,-0.83217 -0.21114,-0.55536 -0.93712,-3.89518 -1.01029,-4.64779 -0.12439,-1.27957 -0.0971,-3.50566 0.057,-4.65553 0.19932,-1.48681 0.19456,-2.17975 -0.0166,-2.41426 -0.0931,-0.10343 -0.24554,-0.21925 -0.33867,-0.25736 -0.13352,-0.0547 -0.10323,-0.0704 0.14317,-0.0747 0.17188,-0.003 0.33605,0.0327 0.36483,0.0793 0.0335,0.0543 1.32803,0.0847 3.60544,0.0847 3.35377,0 3.58032,0.01 4.03784,0.17171 1.02214,0.3621 1.63984,0.43478 3.4398,0.40473 1.69191,-0.0282 1.70544,-0.03 2.37892,-0.30203 l 0.67733,-0.27363 2.73894,-4.2e-4 c 2.63756,-3.4e-4 2.76775,0.007 3.51736,0.20672 0.42813,0.11392 0.88401,0.24727 1.01307,0.29634 0.12906,0.0491 0.67985,0.0906 1.22398,0.0923 1.3573,0.004 1.39171,0.0333 1.62077,1.37322 0.22202,1.29868 0.23483,1.75201 0.0711,2.5184 -0.27914,1.30697 -0.34076,1.93425 -0.30935,3.14914 l 0.0318,1.22782 0.35941,0.71544 c 0.26413,0.52577 0.6006,0.98638 1.26917,1.7374 0.98665,1.10834 1.19297,1.4903 1.83543,3.39804 0.15504,0.46038 0.33212,0.92872 0.39352,1.04077 0.11299,0.20619 0.18228,0.65095 0.32852,2.10872 0.0444,0.44239 0.11978,1.00618 0.16756,1.25288 0.0478,0.2467 0.11147,0.79915 0.14152,1.22767 0.0538,0.76682 0.0138,1.06425 -0.32533,2.41854 l -0.0925,0.36943 -0.60015,-0.0673 c -0.76526,-0.0859 -0.89788,-0.0832 -1.61614,0.0327 -0.56954,0.0919 -6.98175,0.20262 -7.874,0.13594 z"
          />
          <path
            fill="#000000"
            d="m 100.4626,148.29534 c -1.031157,0.002 -2.057642,0.04 -2.082042,0.11317 -0.01943,0.0582 -0.127642,0.10594 -0.240812,0.10594 -0.36834,0 -1.101207,0.51576 -1.484147,1.04438 -0.19705,0.27207 -0.243396,0.42321 -0.243396,0.79788 0,0.45346 0.0095,0.47142 0.501261,0.94517 0.29591,0.28509 0.642577,0.53008 0.84646,0.59738 0.18996,0.0627 0.345716,0.14331 0.345716,0.17931 0,0.0359 0.0764,0.0893 0.169498,0.11886 0.09313,0.0296 0.168982,0.0962 0.168982,0.14831 0,0.15284 -0.355168,0.48679 -0.517798,0.48679 -0.08227,0 -0.172738,0.0382 -0.201538,0.0848 -0.02878,0.0466 -0.238561,0.0847 -0.465604,0.0847 -0.22705,0 -0.514718,0.0385 -0.639238,0.0858 -0.15855,0.0602 -0.382114,0.0555 -0.746207,-0.0165 -0.48373,-0.0957 -0.570671,-0.15148 -1.253154,-0.8015 -0.881043,-0.83921 -1.182704,-0.98635 -1.926497,-0.94155 -0.52556,0.0317 -0.554779,0.0458 -0.910022,0.43822 -0.2187,0.24156 -0.36742,0.48753 -0.36742,0.60875 0,0.11187 -0.03763,0.2036 -0.08423,0.2036 -0.11093,0 -0.11093,1.07397 0,1.14257 0.0466,0.0288 0.08423,0.12017 0.08423,0.20257 0,0.18611 0.403882,0.80068 0.784965,1.19476 0.58653,0.60654 1.330508,1.18545 1.523421,1.18545 0.07317,0 0.146264,0.0392 0.162264,0.0873 0.07477,0.22431 1.128123,0.36232 2.779159,0.36432 1.619876,0.002 2.232902,-0.0758 2.762105,-0.34985 0.693514,-0.35918 1.452724,-0.69539 1.570444,-0.69505 0.0781,2.1e-4 0.39786,0.13364 0.71055,0.29662 0.31268,0.16299 0.62048,0.29662 0.68368,0.29662 0.0633,0 0.11524,0.029 0.11524,0.0646 0,0.14943 0.94192,0.3903 1.7353,0.4439 0.46567,0.0315 0.94192,0.0627 1.05833,0.0687 0.526,0.0285 2.62036,-0.16144 2.96364,-0.26872 0.42002,-0.13127 1.21134,-0.54743 1.25574,-0.66042 0.0155,-0.0395 0.0788,-0.0718 0.14056,-0.0718 0.1422,0 1.1436,-1.08604 1.1436,-1.24024 0,-0.0632 0.0354,-0.11472 0.0786,-0.11472 0.19554,0 0.34468,-0.55228 0.34468,-1.27589 v -0.74207 l -0.43098,-0.47181 c -0.7694,-0.84185 -1.52027,-0.889 -2.43603,-0.15348 -0.21585,0.17336 -0.41181,0.3343 -0.43511,0.3576 -0.17852,0.17852 -0.82229,0.63049 -1.15807,0.81287 -0.354,0.19234 -0.50696,0.22111 -1.15549,0.21911 -0.56071,-0.002 -0.78502,-0.0354 -0.89607,-0.13591 -0.0814,-0.0737 -0.20823,-0.13436 -0.28163,-0.13436 -0.15607,0 -0.82683,-0.34458 -0.82683,-0.42478 0,-0.0764 0.31358,-0.21515 0.75758,-0.33589 0.45451,-0.12359 0.88215,-0.43666 1.20458,-0.8816 0.20678,-0.28539 0.23926,-0.40843 0.23926,-0.90641 v -0.57619 l -0.45837,-0.46974 c -0.25208,-0.2582 -0.51368,-0.46922 -0.58188,-0.46922 -0.0682,0 -0.16831,-0.0529 -0.22221,-0.11782 -0.11364,-0.13694 -0.48769,-0.21601 -1.3193,-0.27751 -0.32586,-0.0241 -0.61989,-0.0877 -0.65319,-0.14159 -0.0451,-0.0729 -1.08135,-0.10736 -2.11253,-0.10542 z m 15.70395,2.30684 c -0.004,0.005 -0.008,0.01 -0.0114,0.015 9e-4,0.002 0.002,0.003 0.003,0.005 0.004,0.008 0.0175,0.004 0.0264,0.006 -0.005,-0.007 -0.0123,-0.0181 -0.0176,-0.0258 z"
          />
          <path
            fill="#000000"
            d="m 115.74022,144.19895 c -0.43033,0.002 -0.79547,0.029 -0.82837,0.0822 -0.0288,0.0466 -0.1406,0.0848 -0.24856,0.0848 -0.10797,0 -0.2438,0.0572 -0.3018,0.12712 -0.058,0.0698 -0.15424,0.12712 -0.21394,0.12712 -0.27887,0 -1.30999,1.09496 -1.30999,1.39113 0,0.0675 -0.0382,0.14639 -0.0847,0.17519 -0.15082,0.0932 -0.10381,1.88822 0.0589,2.25722 0.0788,0.17863 0.17376,0.32505 0.21136,0.32505 0.0376,0 0.0687,0.0514 0.0687,0.11472 0,0.33927 1.51351,1.57871 1.92804,1.57871 0.085,0 0.19093,0.0349 0.23513,0.0775 0.0442,0.0426 0.17556,0.0965 0.29197,0.11989 v -5.2e-4 c 0.41847,0.0841 1.89203,0.0114 1.92753,-0.0951 0.0187,-0.0562 0.10806,-0.10232 0.19896,-0.10232 0.46509,0 1.54808,-1.08828 1.72651,-1.7353 0.0903,-0.32733 0.091,-1.87088 0.001,-2.20141 -0.0945,-0.34708 -0.58813,-1.10746 -0.91674,-1.41232 -0.32595,-0.30239 -0.92346,-0.66588 -1.3286,-0.80874 -0.17877,-0.063 -0.72096,-0.0993 -1.22783,-0.10438 -0.0634,-6.3e-4 -0.12611,-8.7e-4 -0.18759,-5.2e-4 z"
          />
          <path
            fill="#000000"
            d="m 88.089714,144.02067 c -0.36258,0.003 -0.712964,0.0334 -0.768429,0.0889 -0.04772,0.0477 -0.191204,0.0868 -0.318844,0.0868 -0.127634,0 -0.255937,0.0385 -0.284737,0.0847 -0.02878,0.0466 -0.104148,0.0848 -0.167948,0.0848 -0.37664,0 -1.713621,1.17672 -1.980241,1.74304 -0.06388,0.13568 -0.168344,0.34769 -0.232544,0.47129 -0.07089,0.1366 -0.116789,0.49273 -0.116789,0.90796 0,0.55799 0.03972,0.76747 0.217558,1.14308 0.27601,0.58294 0.731554,1.11729 1.079004,1.26607 0.14838,0.0635 0.403384,0.17611 0.566374,0.25011 v -5.1e-4 c 0.378714,0.17188 0.905726,0.17978 1.215946,0.0181 0.13339,-0.0696 0.314776,-0.1266 0.403076,-0.1266 0.64229,0 1.859793,-1.05599 2.342493,-2.03192 0.31207,-0.63094 0.313676,-0.64209 0.313676,-1.70119 v -1.06557 l -0.307992,-0.37362 c -0.169414,-0.20538 -0.454756,-0.44411 -0.634586,-0.53071 -0.17983,-0.0867 -0.398125,-0.19478 -0.484725,-0.23978 -0.104115,-0.0541 -0.478718,-0.0781 -0.841292,-0.0749 z"
          />
          <path
            fill="#000000"
            d="m 84.871305,131.00079 c -0.957332,0.0133 -1.409432,0.1336 -2.090311,0.46664 -0.74788,0.36582 -1.730126,1.29252 -2.005046,1.89187 -0.455333,0.9927 -1.212329,3.75391 -1.212329,4.42144 0,0.38456 -0.531747,1.14004 -1.74563,2.47943 -2.480879,2.7374 -2.783035,3.16042 -3.924308,5.49734 -0.51,1.04429 -0.736747,1.72136 -1.235067,3.68815 -0.500653,1.97591 -0.615815,3.22263 -0.470255,5.09581 0.121933,1.56904 0.203222,2.02913 0.716752,4.04833 0.553543,2.17664 0.848368,3.02798 1.260388,3.64061 0.19816,0.29464 0.46918,0.7104 0.60203,0.92397 0.37846,0.6084 0.808688,1.10106 1.150318,1.31672 1.438426,0.90805 5.415685,1.20385 18.843294,1.40146 3.306209,0.0486 6.506859,0.10087 7.112229,0.11627 1.2877,0.0327 5.04243,-0.003 12.40338,-0.11885 14.5992,-0.22932 18.77945,-0.41908 19.73367,-0.89504 0.61056,-0.30453 1.41757,-1.44821 2.03399,-2.88251 1.25351,-2.91667 1.40658,-3.48764 1.73219,-6.46575 0.15504,-1.41816 0.14225,-1.64469 -0.22531,-3.97961 -0.57295,-3.6396 -1.72996,-6.36962 -3.94239,-9.30485 -0.29492,-0.39128 -0.53589,-0.73843 -0.53589,-0.77153 0,-0.0331 0.11111,-0.6844 0.24702,-1.44746 0.38103,-2.1395 0.45109,-2.82178 0.41289,-4.01216 -0.0507,-1.57645 -0.34116,-2.26878 -1.39681,-3.32848 -0.67782,-0.68042 -1.43284,-0.97421 -3.5388,-1.37769 -1.29874,-0.24881 -1.55376,-0.23292 -4.40025,0.27595 -1.81084,0.32373 -3.03929,0.63796 -4.27829,1.09451 -0.75667,0.27877 -1.08679,0.3575 -1.48157,0.3545 -0.45665,-0.004 -4.30309,-0.73137 -5.03742,-0.95292 -0.43468,-0.13108 -1.42867,-0.26953 -4.86843,-0.67696 -0.37254,-0.0441 -1.05828,-0.12925 -1.52394,-0.18965 -1.01899,-0.13221 -3.62036,-0.12509 -5.05861,0.0145 -3.042351,0.29485 -4.838321,0.52681 -5.986194,0.77256 -1.609933,0.34471 -2.315634,0.43161 -3.193087,0.39481 -0.801113,-0.0336 -0.908933,-0.0597 -1.566313,-0.38344 -1.313806,-0.64708 -3.187151,-1.02005 -5.489587,-1.09295 -0.21803,-0.007 -0.416617,-0.012 -0.59893,-0.0145 -0.159524,-0.002 -0.306621,-0.002 -0.443384,-5.2e-4 z m 0.407211,1.98386 c 0.698883,0.007 3.138247,0.45801 3.672127,0.67954 0.15702,0.0652 0.371447,0.11834 0.476457,0.11834 0.362203,0 1.820714,0.50239 2.947107,1.01493 l 1.129646,0.51366 1.221114,-0.25063 c 4.004402,-0.8222 6.484183,-1.06649 10.127033,-0.99839 1.9299,0.0361 2.62574,0.0802 3.32899,0.21291 0.99337,0.18744 2.28054,0.41062 4.23334,0.7338 0.72178,0.11945 2.26456,0.42997 3.42873,0.68988 2.64417,0.59036 3.11306,0.61323 4.26434,0.20981 1.01851,-0.3569 1.50743,-0.48191 2.32647,-0.59531 0.36505,-0.0505 0.95534,-0.20869 1.31207,-0.35192 1.06438,-0.42737 2.07424,-0.59951 3.52743,-0.60151 1.26142,-0.002 1.96288,0.0779 2.81481,0.31832 0.61759,0.17424 0.69912,0.38997 0.69712,1.84537 -0.002,1.18353 -0.1052,1.9619 -0.46974,3.52433 -0.31869,1.36597 -0.36755,1.61585 -0.37155,1.90738 -0.004,0.27068 0.31278,0.78256 1.78077,2.87631 1.31527,1.87603 2.29897,4.12265 2.7435,6.26628 0.39234,1.89201 0.48093,4.71808 0.2098,6.68797 -0.10097,0.73359 -0.70709,2.65791 -1.05109,3.33675 -0.22047,0.43502 -1.31986,1.86018 -1.52239,1.97352 -0.33757,0.18892 -8.18791,0.47266 -15.83779,0.57206 -15.43343,0.20045 -34.823346,-0.10585 -37.377052,-0.59015 -1.084753,-0.20573 -2.116292,-1.54871 -2.992065,-3.89537 -1.257713,-3.37001 -1.382149,-6.79623 -0.367936,-10.11773 0.382423,-1.25242 0.486964,-1.51964 1.062467,-2.70939 0.753543,-1.55779 1.281301,-2.23769 3.352767,-4.31964 l 1.708423,-1.71669 0.09095,-0.49557 c 0.19884,-1.08353 0.52872,-3.3047 0.52865,-3.55999 -3e-5,-0.14894 0.09477,-0.57154 0.21084,-0.93896 0.17415,-0.55129 0.30639,-0.7795 0.75551,-1.30587 0.719213,-0.84291 1.113239,-1.04304 2.039152,-1.03404 z m 32.725654,17.03772 c 0.0176,0.0269 0.0344,0.0543 0.0506,0.0816 0.007,0.0113 0.0384,-0.0199 0.0279,-0.0279 -0.024,-0.0183 -0.0504,-0.0365 -0.0785,-0.0537 z m -15.35721,5.61981 v 5.2e-4 c 10e-4,7.7e-4 0.002,0.001 0.003,0.002 9.1e-4,6e-4 -0.004,-0.003 -0.003,-0.003 z m 0.003,0.003 c -0.017,-0.009 0.0662,0.0474 0.1018,0.0615 0.004,0.001 0.007,0.002 0.0109,0.004 -0.0371,-0.0217 -0.0686,-0.0391 -0.11265,-0.0656 z"
          />
        </g>
      </svg>
      "##
    );

    let opt = Options::default();
    // opt.default_size = Size::new(1000.0, 1000.0).unwrap();
    // opt.shape_rendering = ShapeRendering::OptimizeSpeed;
    // opt.image_rendering = ImageRendering::OptimizeSpeed;
    // Get file's absolute directory.
    // opt.fontdb.load_system_fonts();

    let rtree = Tree::from_data(svg_data.as_bytes(), &opt.to_ref()).unwrap();

    // let pixmap_size = rtree.size.to_screen_size();
    let mut pixmap = Pixmap::new(400, 400).unwrap();
    render(
        &rtree,
        FitTo::Original,
        Transform::default(),
        pixmap.as_mut(),
    )
    .unwrap();

    pixmap.encode_png().unwrap()
}
